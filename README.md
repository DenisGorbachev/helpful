<!-- DO NOT EDIT -->
<!-- This file is automatically generated by README.ts. -->
<!-- Edit README.ts if you want to make changes. -->

# Better anyhow::Error with a more descriptive error message

[![Build](https://github.com/DenisGorbachev/helpful/actions/workflows/ci.yml/badge.svg)](https://github.com/DenisGorbachev/helpful)
[![Documentation](https://docs.rs/helpful/badge.svg)](https://docs.rs/helpful)

The [`helpful::Error`][__link0] is an upgraded version of [`anyhow::Error`][__link1].
It provides extra information to users and developers, which simplifies debugging & diagnosing the root cause.

## Compare

### Anyhow

```shell
$ example_anyhow --config some/config.json
Error: No such file or directory (os error 2)
```

No extra information is provided - we have to guess what went wrong.

### Helpful

```shell
$ example_helpful --config some/config.json
Error: No such file or directory (os error 2)

Call history (recent first):
   0: config::load
           with path="some/config.json"
             at examples/simple_helpful.rs:42
   1: cli::run
           with self=Cli { config: "some/config.json" }
             at examples/simple_helpful.rs:28
```

Extra information is provided - we can see that the error happened in `config::load` because `some/config.json` does not exist.

Note: if you set `RUST_BACKTRACE=1`, both `anyhow` and `helpful` will display a full backtrace. However, the backtrace doesn’t contain the values of the function arguments, so `helpful` will display both the span trace and the backtrace.

## Features

* ✅ Can be propagated up the call stack, just like [`anyhow::Error`][__link2]
* ✅ Can be constructed from existing error types, just like [`anyhow::Error`][__link3]
* ✅ Captures the current tracing span, just like [`tracing_error::TracedError<E>`][__link4]

## Benefits

* Provides a detailed span trace to the user (which makes it easier to diagnose the root cause of the error).
* Provides a detailed span trace to the developer (which simplifies debugging).

## Comparison with [`anyhow::Error`][__link5]

**Advantages:**

* Provides additional information from the current span trace.

**Disadvantages:**

* Uses `Box<dyn Error>` instead of a slim pointer (this will be improved in the future release).

## Comparison with [`tracing_error::TracedError<E>`][__link6]

**Advantages:**

* Can be propagated up the call stack with `?` operator (no explicit conversion needed). This is because [`helpful::Error`][__link7] doesn’t have any generic arguments, so you can compose the functions that return a [`helpful::Result<T>`][__link8] with the `?` operator. By contrast, [`tracing_error::TracedError<E>`][__link9] is generic over `E`, so you can’t compose the functions that return different `Result<T, TracedError<E>>`.

**Disadvantages:**

* Uses `Box<dyn Error>` instead of a slim pointer (this will be improved in the future release).

## Setup

* Initialize the tracing subscriber in `main`.
* Ensure the tracing subscriber has an [`ErrorLayer`][__link10].
* Ensure the default level is set to `Level::INFO` (or modify your `instrument` attributes to collect the data at a higher level).

Example:

```rust
fn main() {
   init_tracing_subscriber();
    // your code here
}

fn init_tracing_subscriber() {
   use tracing_subscriber::util::SubscriberInitExt;
   use tracing::level_filters::LevelFilter;
   use tracing_error::ErrorLayer;
   use tracing_subscriber::layer::SubscriberExt;

   let env_filter = tracing_subscriber::EnvFilter::builder().with_default_directive(LevelFilter::INFO.into()).from_env_lossy();
   let subscriber = tracing_subscriber::fmt()
       .with_env_filter(env_filter)
       .finish()
       .with(ErrorLayer::default());
   subscriber.init();
}
```

## Important setup note

If you don’t see any tracing spans in the error message, check your tracing subscriber configuration (see “[Setup](#setup)” for an example of a correct configuration).

### No-std support

You can use this crate in `no_std` environment by disabling `default-features`:

```toml
[dependencies]
helpful = { version = "0.1.0", default-features = false }
```

The no_std mode enables the internal `StdError` trait which is a replacement for `std::error::Error`.
Since the `?`-based error conversions would normally rely on the `std::error::Error`, no_std mode will require an explicit `.map_err()`.

## Tips

### Formatting

You can format the fields using `Display` instead of `Debug` using the `%` symbol:

```rust
use std::fmt::{Display, Formatter};
use tracing::instrument;

#[instrument(fields(url = %url))]
pub fn load(url: &Url) -> helpful::Result<String> {
    todo!()
}
```

   [__cargo_doc2readme_dependencies_info]: ggGkYW0BYXSEGyMws-dKI-LpG9swkVXG-rikGwSuJGhB0NVbG974QPrPJF6XYXKEG4D4a25ndkhxGz1E551Bk0FbG_D8FcoQTPCzGy6lUZQALK6kYWSCgmdoZWxwZnVsZTAuMS4wgm10cmFjaW5nX2Vycm9yZTAuMi4w
 [__link0]: https://docs.rs/helpful/latest/helpful/struct.Error.html
 [__link1]: https://docs.rs/anyhow/latest/anyhow/struct.Error.html
 [__link10]: https://docs.rs/tracing_error/0.2.0/tracing_error/?search=ErrorLayer
 [__link2]: https://docs.rs/anyhow/latest/anyhow/struct.Error.html
 [__link3]: https://docs.rs/anyhow/latest/anyhow/struct.Error.html
 [__link4]: https://docs.rs/tracing-error/latest/tracing_error/struct.TracedError.html
 [__link5]: https://docs.rs/anyhow/latest/anyhow/struct.Error.html
 [__link6]: https://docs.rs/tracing-error/latest/tracing_error/struct.TracedError.html
 [__link7]: https://docs.rs/helpful/latest/helpful/struct.Error.html
 [__link8]: https://docs.rs/helpful/latest/helpful/type.Result.html
 [__link9]: https://docs.rs/tracing-error/latest/tracing_error/struct.TracedError.html


## Installation

```shell
# add peer dependencies
cargo add tracing tracing-subscriber tracing-error
# add the crate
cargo add helpful
```

## Gratitude

Like the project? [⭐ Star this repo](https://github.com/DenisGorbachev/helpful) on GitHub!

## License

[Apache License 2.0](LICENSE-APACHE) or [MIT License](LICENSE-MIT) at your option.

Unless you explicitly state otherwise, any contribution intentionally submitted for inclusion in this crate by you, as defined in the Apache-2.0 license, shall be dual licensed as above, without any additional terms or conditions.
